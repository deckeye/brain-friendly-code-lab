---
layout: default
title: 業務アプリケーションにおけるUX配慮事項レポート
---
{% raw %}

# 業務アプリケーションにおけるUX配慮事項レポート

**作成日**: 2025年12月25日  
**プロジェクト**: Brain-Friendly Code Lab - PDF入力アシスタント開発

---

## 📋 目次

1. [概要](#概要)
2. [UI設計における配慮の原則](#ui設計における配慮の原則)
3. [入力体験の最適化](#入力体験の最適化)
4. [エラー処理とフィードバック](#エラー処理とフィードバック)
5. [レイアウトと表示の工夫](#レイアウトと表示の工夫)
6. [技術的な実装配慮](#技術的な実装配慮)
7. [ユーザー設定とパーソナライゼーション](#ユーザー設定とパーソナライゼーション)
8. [今後の展開](#今後の展開)

---

## 概要

本レポートは、業務アプリケーション（特にPDF参照型入力フォーム）の開発において重視したUX配慮事項を体系的にまとめたものです。認知負荷の軽減、エラー予防、使いやすさの向上を3本柱として、実装レベルでの具体的な配慮を記録しています。

---

## UI設計における配慮の原則

### 1. 認知負荷を最小化する設計

#### 1.1 シンプルで直感的なUI
- **複雑すぎる機能は削除する判断**
  - 当初：フィールド内インラインヒント（複雑な実装）
  - 改善後：ラベル横のⓘアイコン（シンプル・安定）
  - 理由：実装の複雑さがバグの温床になり、ユーザーにも分かりづらい

- **視覚的な情報の整理**
  - 必須項目の明示（`*`マーク）
  - ヒント情報は必要時のみ表示（ホバー）
  - エラーは視覚的に目立つが、邪魔にならない

#### 1.2 ワーキングメモリへの配慮
- **PDFと入力フォームの同時表示**
  - PC：画面分割レイアウト
  - タブレット：タブ切り替え
  - スマートフォン：3段階オーバーレイ

- **プログレスバッジの常時表示**
  - 現在の進捗（5件中3件完了）
  - 次にすべきことが明確

### 2. ユーザーの作業文脈を維持

#### 2.1 自動保存
- 入力中のデータを`localStorage`に自動保存
- ページをリロードしても入力内容が保持される

#### 2.2 シームレスな入力フロー
- リアルタイムバリデーション
- 自動補正により、ユーザーは入力を中断せずに続けられる
- エラーは即座にフィードバック、修正も即座に反映

---

## 入力体験の最適化

### 3. 自動補正による入力ミス削減

#### 3.1 実装した自動補正機能

| 項目 | 自動補正内容 | 具体例 |
|------|-------------|--------|
| **会社名** | 全角スペース→半角、連続スペース削除 | `株式会社　サンプル　　商事` → `株式会社 サンプル 商事` |
| **請求書番号** | 全角→半角、小文字→大文字 | `ｉｎｖ-００１` → `INV-001` |
| **金額** | ¥マーク削除、カンマ削除 | `¥1,250,000` → `1250000` |
| **日付** | 多様なフォーマットを統一形式に変換 | `令和7年1月1日` → `2025-01-01` |

#### 3.2 日付入力の柔軟性

**対応フォーマット（15種類以上）**
```
西暦:
- 2025/01/25
- 2025-01-25
- 2025.01.25
- 20250125 (ハイフンなし) ← 今後実装予定

和暦:
- 令和7年1月25日
- R7.1.25
- 令和7/1/25

欧州形式:
- 25/01/2025
- 25-01-2025
- 21-01-2200 (DD-MM-YYYY判別)

相対日付:
- 今日、明日、昨日
- 1週間後、2ヶ月前
```

**配慮ポイント：**
- ユーザーは自分の慣れたフォーマットで入力できる
- システムが自動で統一形式に変換
- 曖昧な日付は設定に基づいて解釈（後述）

### 4. IME入力への対応

#### 4.1 日本語IME入力時の文字重複問題の解決

**問題**
```
入力: "あいう" (IME変換中)
→ 自動補正が干渉
→ 表示: "ああいいうう" (文字が重複)
```

**解決策**
```javascript
// Composition Events を使用
let isComposing = false;

input.addEventListener('compositionstart', () => {
    isComposing = true; // IME入力開始
});

input.addEventListener('compositionend', (e) => {
    isComposing = false; // IME入力終了
    // 確定後に自動補正を実行
    applyAutoCorrection(e.target);
});

input.addEventListener('input', (e) => {
    if (!isComposing) {
        // IME入力中でなければ自動補正
        applyAutoCorrection(e.target);
    }
});
```

**効果**
- ✅ IME変換中は自動補正をスキップ
- ✅ 確定後に自動補正を適用
- ✅ 日本語入力がスムーズに

---

## エラー処理とフィードバック

### 5. エラー表示のバランス

#### 5.1 当初の課題
- エラーメッセージ用の領域を事前確保 → **一覧性が下がる**
- インラインヒントが複雑 → **動作が不安定**

#### 5.2 改善後のエラーUI設計

**3層構造のエラー表示**

1. **視覚的なフィードバック（レベル1）**
   ```css
   /* フィールドの背景と枠を赤く */
   .form-input.error {
       background-color: #fff5f5;
       border-color: #e53e3e;
   }
   ```

2. **エラーアイコン（レベル2）**
   ```html
   <!-- フィールド右に ⚠ アイコン -->
   <div class="error-icon">⚠</div>
   ```
   - マウスオーバー：エラー内容をツールチップ表示
   - クリック：エラー内容を固定表示
   - 再クリック：消去

3. **アノテーション（レベル3）**
   ```css
   /* フィールド下に赤枠のメッセージ */
   .error-annotation {
       background: #fff5f5;
       border-left: 4px solid #e53e3e;
       padding: 0.75rem;
   }
   ```

**配慮ポイント：**
- エラーがない時は領域を占有しない（CLS対策）
- エラー時は視覚的に目立つ
- 詳細情報は必要な時だけ表示

### 6. レイアウトシフト（CLS）の防止

#### 6.1 CLS（Cumulative Layout Shift）とは
- Googleが重視するCore Web Vitalsの1つ
- ページ読み込み中・操作中に要素が予期せず移動すること
- **業務アプリでは特に重要**：入力中にボタンがズレるとミスの原因に

#### 6.2 実装した対策

**エラーメッセージの表示方法**
```css
/* 旧版：領域を事前確保（余白が多すぎる） */
.error-message {
    min-height: 24px; /* 常に領域確保 */
}

/* 新版：必要時のみ表示（CLSは発生するが許容） */
.error-annotation {
    /* 領域確保なし */
    /* エラー時のみ表示 */
}
```

**判断基準**
- ページ読み込み時のCLS：最優先で防ぐ
- ユーザー操作後のCLS（エラー表示など）：許容範囲
- トレードオフ：一覧性 vs CLS → **一覧性を優先**

---

## レイアウトと表示の工夫

### 7. レスポンシブなオーバーレイ設計（スマートフォン）

#### 7.1 オーバーレイの段階的な表示

**当初の課題**
- オーバーレイが画面の大部分を覆う
- PDF下部がスクロールしても見えない

**改善後：3段階オーバーレイ**

```
【最小化】 ⏫
┌──────────┐
│  PDF全体  │
│  見える   │
├──────────┤
│ [進捗] ⏫ │ ← ヘッダーのみ表示
└──────────┘

【通常】 ∨
┌──────────┐
│  PDF上部  │
├──────────┤
│  フォーム  │
│  (50vh)   │ ← 適度なバランス
│ [進捗] ∨  │
└──────────┘

【最大化】 ⏬
┌──────────┐
│ [進捗] ⏬ │
├──────────┤
│  フォーム  │
│  (80vh)   │ ← 入力に集中
│          │
└──────────┘
```

**CSS実装**
```css
.layout-overlay {
    padding-bottom: 55vh; /* PDF下部スクロール用 */
}

.overlay-form.minimized { max-height: 60px; }
.overlay-form.normal { max-height: 50vh; }
.overlay-form.expanded { max-height: 80vh; }
```

**シェブロンアイコンの工夫**
- 最小⇔通常：単矢印（∨、∧）
- 通常⇔最大：ダブルシェブロン（⏫、⏬）
- **自然な向き**：タップ方向を示す

#### 7.2 PC・タブレット対応
- **PC**：左右分割レイアウト（PDF 60% / フォーム 40%）
- **タブレット**：タブ切り替え
- **スマートフォン**：オーバーレイ

---

## 技術的な実装配慮

### 8. パフォーマンスと安定性

#### 8.1 デバウンス処理
```javascript
let autoSaveTimer;
input.addEventListener('input', () => {
    clearTimeout(autoSaveTimer);
    autoSaveTimer = setTimeout(() => {
        saveFormData(); // 300ms後に保存
    }, 300);
});
```

#### 8.2 エラーハンドリング
- バリデーションエラーは即座にフィードバック
- ネットワークエラーは明確に通知
- 自動保存により、データ損失を防ぐ

### 9. 貼り付け（ペースト）の最適化

#### 9.1 スマート抽出

**日付フィールドへの貼り付け**
```javascript
// 貼り付けたテキストから日付を自動抽出
"請求日: 2025年1月25日 金額: ¥1,250,000"
↓
自動抽出: "2025年1月25日"
↓
自動変換: "2025-01-25"
```

**配慮ポイント：**
- PDF全文をコピペしても、日付部分だけ抽出
- ユーザーに「日付を抽出しました」とヒント表示
- 元のテキストは上書きせず、抽出した日付のみ挿入

---

## ユーザー設定とパーソナライゼーション

### 10. 日付フォーマット設定

#### 10.1 曖昧な日付の解釈

**問題**
```
入力: "01/02/2025"
→ 日本/米国: 1月2日
→ 欧州: 2月1日
→ どちらか不明！
```

**解決策：優先フォーマット設定**

```
┌─────────────────────┐
│  日付フォーマット設定  │
├─────────────────────┤
│ ○ 自動判別（デフォルト）│
│ ○ 日本/米国形式優先    │
│   （MM/DD/YYYY）      │
│ ○ 欧州形式優先        │
│   （DD/MM/YYYY）      │
├─────────────────────┤
│ 今後実装予定：        │
│ - 中国式（YYYY年MM月DD日）│
│ - インド式            │
│ - イスラム暦          │
└─────────────────────┘
```

**保存方法**
```javascript
class UserSettings {
    constructor() {
        this.settings = JSON.parse(
            localStorage.getItem('userSettings') || '{}'
        );
    }
    
    set(key, value) {
        this.settings[key] = value;
        localStorage.setItem('userSettings', 
            JSON.stringify(this.settings));
    }
}
```

#### 10.2 今後の展開
- **言語に応じた自動並び替え**
  - 日本語環境：日本形式が上位
  - 英語環境：米国形式が上位
  - ドイツ語環境：欧州形式が上位

---

## 今後の展開

### 11. 未実装機能（優先度順）

#### 高優先度
1. **ハイフンなし日付の変換**
   ```
   入力: 20250125
   → 2025-01-25
   ```

2. **多国籍フォーマットの追加**
   - 中国式：2025年1月25日
   - インド式：25-01-2025
   - イスラム暦：1446年7月24日

3. **カレンダー入力とテキスト入力の連携強化**
   - カレンダーで選択 → テキスト欄に反映
   - テキスト入力 → カレンダーに反映

#### 中優先度
4. **エラー表示の切り替え機能**
   - コンパクトモード：領域確保なし（現在）
   - ゆったりモード：領域を事前確保（CLS防止）

5. **アンドゥ/リドゥ機能**
   - 誤入力の即座の取り消し

6. **入力履歴のサジェスト**
   - 過去に入力した会社名を候補表示

#### 低優先度
7. **オフライン対応の強化**
   - Service Workerによるオフライン動作

8. **音声入力対応**
   - Web Speech APIを使用

---

## まとめ

### 配慮の3本柱

```
┌─────────────────────────────────┐
│  1. 認知負荷の軽減               │
│     - シンプルなUI               │
│     - 作業文脈の維持             │
│     - 進捗の可視化               │
└─────────────────────────────────┘
           ↓
┌─────────────────────────────────┐
│  2. エラー予防と容易なリカバリー   │
│     - 自動補正                   │
│     - リアルタイムバリデーション   │
│     - 明確なエラー表示           │
└─────────────────────────────────┘
           ↓
┌─────────────────────────────────┐
│  3. 柔軟性とパーソナライゼーション │
│     - 多様な入力フォーマット対応   │
│     - ユーザー設定の保存         │
│     - デバイスに応じたレイアウト   │
└─────────────────────────────────┘
```

### 開発プロセスでの学び

1. **シンプルさの重要性**
   - 複雑な機能は削除する勇気を持つ
   - ユーザーが理解できないUIは価値がない

2. **トレードオフの判断**
   - CLS vs 一覧性 → 一覧性を優先
   - 自動補正 vs 自由度 → バランスを取る

3. **実装の前に検証**
   - IME入力の問題は実装後に発覚
   - 早期のテストが重要

4. **ユーザーの文脈を理解**
   - 業務アプリでは「速さ」より「正確さ」
   - PDFを見ながら入力する → 同時表示が必須

---

## 参考資料

### 作成したドキュメント
1. `UI_DESIGN_GUIDELINES_ERROR_PREVENTION.md` - エラー予防ガイドライン
2. `UI_UX_QUALITY_METRICS.md` - CLS等の品質指標
3. `PDF_INPUT_ASSISTANT_DESIGN.md` - レイアウト設計
4. `INPUT_AUTO_CORRECTION_GUIDE.md` - 自動補正パターン集
5. `IME_INPUT_FIX.md` - IME入力問題の解決
6. `DATE_FORMAT_PATTERNS.md` - 日付フォーマットパターン

### デモページ
- `demo-pdf-input.html` - 実装サンプル
- GitHub Pages: https://deckeye.github.io/brain-friendly-code-lab

---

**作成者**: AI Assistant (Claude)  
**レビュー**: 必要に応じて更新  
**ライセンス**: MIT License

{% endraw %}
